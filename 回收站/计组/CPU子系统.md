[[2024-03-19]]
## 概述
### CPU概述 （模型机）
- 运算部件
- 寄存器组 暂时存放控制信息与数据信息 通用寄存器组 暂存器 指令寄存器（IR）程序计数器（PC）按照字节编址 程序状态寄存器（PSW）地址寄存器（MAR） 数据缓存寄存器（MDR）
其中，PC寄存器是在汇编代码中可见的
- 控制器
组合逻辑控制方式 直接使用硬件电路进行控制：
- 三级时序系统：依靠不同的时间标志,让CPU分步工作,通常采用 工作周期、时钟周期和工作脉冲三级时序。
微程序控制方式 只设定微小的控制指令电路，然后将控制指令编程构成控制逻辑
- 时序系统
脉冲，节拍，周期
振荡器为CPU提供时钟基准
CPU时钟周期信号（节拍信号）->机器周期信号（工作周期信号）->指令周期信号

- CPU内部的连接
单内总线 分立寄存器与内总线相连
单内总线 集成寄存器与内总线相连
多组内总线结构（现代CPU结构）

### CPU的主要功能
- 处理指令
- 控制时间（执行顺序）
工作过程:
取指令
指令译码
指令执行
后续工作
#### CPU控制信息传送的方式
- 通过程序输入输出方式
- 中断方式（systemcall?）
- DMA方式
- 通道方式（pipe）


[[2024-03-25]]

## 3.2指令系统
### 3.2.1指令集（略）
- CISC
- RISC
### 3.2.2指令的一般格式
操作码+地址码
#### 指令字长
- 定长指令格式
便于控制
指令空间上产生浪费
- 变长指令格式
合理利用存储空间
长度不固定
#### 操作码的结构
1.定长操作码 指令位置 位数固定相同
2.扩展操作码 指令位置 位数不固定，根据需要灵活变化
3.复合型操作码 将操作码分为几部分，每部分表示一种操作

#### 地址结构
指令中提供的地址：
存储单元地址码
寄存器编号
#### 指令提供地址的方式
显示地址方式
隐地址方式 隐含约定一些地址 如程序计数器/栈指针 

#### 三地址结构指令（隐地址）
D1 D2 D3
由于程序计数器的存在，不需要给出下一操作的地址，只需要将程序计数器加一即可
同时默认将运算结果存在期中的某一寄存器，用于节省空间
对于循环等非顺序执行结构，只要用转移指令修改程序计数器即可

0地址的指令，栈操作，停机操作

### 3.2.3常见寻址方式

#### 1.立即寻址
指令给出操作数
用来提供常数，设定初始值
（这算寻址吗？）

#### 2.直接寻址（绝对寻址）
指令给出操作数地址
地址可以是主存储单元号（操作数在主存） 访问一次主存
或者寄存器号（操作数在寄存器）不访问主存

即指令给出指针值 

对于定长格式的指令，由于有效地址长度影响，能够被访问的地址数量是有限的，往往无法覆盖整个地址空间
变长格式则没有这个问题

#### 3.间接寻址
指令给出的是操作数的间接地址（指针的指针）

可以是
主存间接寻址
主存储单元号（操作数在此存储单元指向的地址）需要访问两次主存

寄存器间接寻址
寄存器号（存的是操作数在主存中的地址）需要访问一次主存
寄存器间接寻址方式能够访问整个主存空间
指针不变，指针内容可变，则同一个指令加指针即可访问任意存储空间，实现程序的循环，共享，并提供转移地址等复杂操作


堆栈间接寻址
若堆栈向上生成
自增型寄存器寻址 出栈
先向SP指向区块中读取数据，再自增1
自减型寄存器寻址 入栈
SP自减1，往指向的主存区块存入数据

#### 变址寻址
指令给出一个寄存器编号和一个形式地址
操作数等于主存中寄存器编号中存储的地址偏移量加上形式地址作为基准地址值得到的地址所指向的位置
即对指针进行寄存器中偏移量加减操作（不改变基准地址值），即可访问主存指定位置的数据
基准地址值需要覆盖整个主存空间，那么需要较长的空间，而寄存器编号则只需要较小的空间
适合访问线性区块数据，一维数组的遍历
#### 基址寻址
将变址寻址的寄存器与基址位置互换，
适用于线性的一定间隔的数据访问，例如访问一个结构体数组中的某一个数据
则只需要在寄存器中改变基准地址（可以加偏移量或者其他方法）即可跳跃式访问所需数据
二维数组的列遍历（行优先排列）

[[2024-03-26]]
其他应用：程序的重定位，虚拟内存映射，扩展有限字长的寻址空间

### 基址+变址寻址
指令给出两个寄存器号和一个地址量，寄存器内容与地址量之和为有效地址

### PC相对寻址
指令给出位移量，PC当前内容与位移量之和为有效地址

### 页面寻址
指令给出位移量，PC的高位部分与位移量拼接

### 对寻址方式的补充说明
操作码隐含说明不同的寻址方式



## 3.2.4指令功能与类型
1.传输指令
2.访存指令
3.输入输出（I/O）指令
4.算术逻辑运算指令
5.程序控制指令

   1.转移指令
   无条件转移break 条件转移if 循环while
   2.转子指令和返回指令
     一般用堆栈存放返回地址
   3.软中断指令
   早期用于程序测试
   4.控制处理机的某些指令
   5.面向操作系统的指令

[[2024-04-01]]

### 3.3CPU模型机的设计
简易的16位CPU

#### CPU设计步骤
拟订指令系统
确定总体结构
安排时序
拟订指令流程和微命令序列
形成控制逻辑

#### 3.4.1指令系统的设计

1.指令格式
指令字长16位
主存也是16位为一个存储单元

双操作数指令格式：

单操作数指令格式：

转移指令格式：

2.寻址方式
采用寄存器寻址，寄存器间接寻址，自减型寄存器间接寻址，自增型寄存器间接寻址
变址寻址
相对寻址
跳步
主存直接寻址需要16位，无法实现
立即寻址也需要占用16位，也无法实现

同时利用程序计数器PC，实现连续访问下一条指令，从而使第二条指令为第一条指令提供地址信息

3.指令操作类型
转子指令的特殊操作：将PC,PSW分别存入栈中，再进行跳转，子程序返回时再提取栈中PC,PSW


#### 3.4.2CPU基本部件和数据通路
1.寄存器

2.运算器

3.总线与数据通路结构

4.各类信息的传送途径

[[2024-04-02]]
外总线 
内总线
一点补充：MAR MDR的作用，简要说明就是
[[2024-04-08]]
模型机中
汇编指令：由于模型机的16位字长限制，一条汇编指令还需要被拆分成更细分的部分来分别存储，因此需要利用PC自增来实现一条汇编指令的完整执行过程


 ###### 指令周期（Instruction Cycle）

CPU从存储器中**取出并执行一条指令所需的全部时间**称之为指令周期。

######  时钟周期（cycle，clock cycle）

**主频：计算机内部主时钟的频率**，通常以MHz或者GHz为单位，是生产设计CPU时就已经确定下来的。
各个工作周期的细节
**时钟周期（cycle）：**定义为主频的倒数，有时也称之为**节拍（pulse）**

时钟周期是计算机中**最基本的、最小的时间单位**，在一个时钟周期内计算机仅能完成一个**“微操作”**或若干**相容的**（数据通路上不发生冲突、互不干扰的）**“微操作”**。

时钟周期 = 节拍 ≈ 微指令周期
寄存器级别的操作指令

硬件级别的控制指令（微命令）
访存: EMAR R W SIR SMDR 
内部数据通路的：Ri→A/B A+1 DM CPRi/Si 
周期转换：1→FT/ST/DT/ET T+1 CPFT/ST/DT/ET
[[2024-04-09]]
操作时间表

##### 3.6 微程序控制方式
关键元件 控制存储器 CM