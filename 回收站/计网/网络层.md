网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。
 网络在发送分组时不需要先建立连接。每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）。

网络层不提供服务质量的承诺。即所传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证分组传送的时限。

由于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉（与电信网的交换机相比较）。
如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的主机中的运输层负责可靠交付（包括差错处理、流量控制等） 。
<span style="background:#d3f8b6">采用这种设计思路的好处是：网络的造价大大降低，运行方式灵活，能够适应多种应用。</span>
ARP:本地局域网内将IP与MAC地址进行映射的协议


子网掩码
CIDR

### 地址解析协议ARP
（局域网内解析MAC地址，非局域网的两主机不需要）
- 用来将局域网内IP地址解析为MAC硬件地址，供底层传输信息使用
- 对于一个链接了多个局域网的路由器，可以在不同局域网中有不同的IP地址，但是只有唯一的一个MAC地址
### IP地址分类
（二进制）
网络号+主机号
A类地址：8+24 以0开头 net-id 1byte
B类地址：16+16  以10开头 net-id 2byte
C类地址：24+8  以110开头 net-id 3byte
D类地址：多播地址，以1110开头
E类：1111开头，保留今后使用
![[Pasted image 20240523222518.png]]
### CIDR无分类编址
简而言之，利用子网掩码与IP地址相结合，同一个IP地址在不同的子网掩码下的归属不同，扩展了IP地址的数量，代价是表示地址所占用的空间也变为两倍。
如果要得到IP地址所在子网
子网掩码需要与IP地址进行与运算，得到的网络地址即可代表所在的子网

### IP层转发分组的过程
#### 最基本的操作
- 基于终点的转发
- 最长前缀匹配
#### 使用二叉线索查找转发表
### 网际控制报文协议ICMP
ICMP 报文是装在 IP 数据报中，作为其中的数据部分
注意，这部分需要与传输层的TCP可靠传输所使用的协议不一样
这里目前是网络层
### ICMP报文种类
差错报告报文
询问报文
### IPv6 
128位地址，目前来看拥有足够的地址空间

### IP 数据报的格式

一个 IP 数据报由首部和数据两部分组成。

首部的前一部分是固定长度，共 20 字节，是所有 IP 数据报必须具有的。

在首部的固定部分的后面是一些可选字段，其长度是可变的。
数据报的最大长度为 65535 字节。

总长度必须不超过最大传送单元 MTU。

#### IP 数据报分片
==注意：这里一般会给出数据报的最大长度（一般是按照字节来计算的，很少有按照比特来计算的），然后需要去掉数据报首部占用的字节数，剩下的才能作为数据部分的最大分片长度。==

一数据报的总长度为 3820 字节，其数据部分的长度为 3800 字节（使用固定首部），需要分片为长度不超过 1420 字节的数据报片。

因固定首部长度为 20 字节，因此每个数据报片的数据部分长度不能超过 1400 字节。

于是分为 3 个数据报片，其数据部分的长度分别为 1400、1400 和 1000 字节。
分片之后的偏移字段的单位是4字节
“数据偏移”的单位是 32 位字（以 4 字节为计算单位）。
也就是说第一片的序列为0
第二片是350


##### 数据报的性质:
实现了分组转发的优先级控制
支持更好的流式传输
分组的基本首部之后有可选首部
支持跳数限制
###### 目的地址的三种基本类型
- 单播
- 多播
- 任播:传递至目的地址集合中的一组计算机的任何一台即可

采用冒号十六进制记法
0压缩（省略一部分全0序列）
#### 从IPv4到IPv6
双协议栈（成本过高）
隧道技术:在IPv4网络中，将IPv6数据报重新封装成IPv4数据报，离开IPv4网络时再拆包正常传输

### 本地地址与全球地址

### 互联网的路由选择协议 这是重点
#### 分层次的路由选择协议

将一个互联网分成许多较小的自治系统AS，AS外采用统一的外部网关协议，AS内各自可以采用适用的不同的内部网关协议
##### 内部网关路由协议
- RIP （最简单的路由协议，路由器及终端之间交换更新转发表） 距离向量算法 只与相邻路由器交换信息
优点：简单有效，快速建立路由表，收敛速度快
缺点：只适用于小型网络，坏消息传播得慢，只会选择距离最短路径，即使还有更高速但是低延迟的路径也不会选择

- OSPF 链路状态协议 使用可靠的泛洪法交换附近路由器链路状态信息，最终形成整个网络的链路状态数据库，所有的路由器都能知道整个网络的拓扑状态，
这种方法的网络规模也不能过大，否则交换数据的通信负担与存储负担都比较高，一般对内网区域进行分组，划分出小片区域再将小片区域进行连接 ==另一个特性==：OSPF使用灵活的“代价”评估量取代RIP的网络距离作为衡量标准，实现不同路径的路由方式的选择
##### 外部网关协议IGP
目前广泛使用BGP-4    
自治系统AS之间的外部协议
- 边界路由器 
- 内部路由器  
#### 路由选择算法 (略过了)
### 路由器结构
- 路由选择
- 分组转发 交换结构 输入端口 输出端口 路由器因为拥塞可能会造成丢失分组
