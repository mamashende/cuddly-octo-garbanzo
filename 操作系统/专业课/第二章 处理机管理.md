	### 进程管理

#### 程序的并发时特征
间断性
失去封闭性
不可再现性


#### 进程的结构
程序段
数据段
PCB

#### 进程的特征
动态性
并发性
独立性
异步性

#### PCB
进程控制块

#### 进程与程序的区别
进程是动态的，程序是静态的
进程是程序在数据集上的一次执行过程

#### 进程的三种基本状态
就绪（未运行时等待状态）
执行
阻塞（运行时等待/睡眠）

进程的其他状态
创建
结束
挂起
挂起状态的意义：
将进程由活动状态转变为静止状态，静止状态下的进程不会被调度分配CPU，直到进程被激活

注意与阻塞的区别，阻塞状态下，只要引发阻塞的请求完成，进程仍然可以立刻获得CPU分配
一些导致挂起的操作：
用户请求
操作系统对进程进行检查
空间紧张时挂起并接受操作系统调度


激活


#### 进程状态切换

状态机
![[Pasted image 20240902100317.png]]


#### PCB的具体内容与作用
进程状态
进程优先级
进程调度所需的其他信息
事件：阻塞原因


#### 内核态与用户态
内核态（）：拥有较高的特权，能够执行所有硬件管理操作
用户态：受限执行，发出系统调用请求后切换到内核态执行，执行完毕后回到用户态



#### 进程控制
系统调用不一定都是原语
原语：一系列操作在执行过程中遵循原子性、不可中止操作
例如进程创建，进程终止



#### 进程同步
并发进程的同步


进程间临界资源的互斥
进程间具有先后执行顺序的

临界区
空闲时准许进程进行访问
被占用时其他进程需要等待
占用、等待时间有限
等待的进程不占用CPU



#### 信号量
##### 整型信号量
抢到“锁”的那个进程可以访问，其余进程保持空转
缺点：不遵循让权等待


##### 记录型信号量
抢到锁的那个进程访问，其余进程加入阻塞队列，自我阻塞
s.value--;
abs(value)即为等待进程数量

当进程访问完毕，唤醒阻塞队列第一个进程
阻塞的唤醒由操作系统负责
s.value初始值为1时，即视为互斥型信号量


##### AND型信号量
将进程所需的多个临界资源打包原子性地一次性分配给进程，防止进程之间出现死锁

##### 信号量集
加强版AND型信号量，更多资源的分配管理

一些特殊的信号量集
SP(S,d,d)
单信号量S，允许一次申请d个资源，现有资源数少于d时，不继续分配资源

SP(S,1,1)
退化为一般的记录型信号量

SP(S,1,0)
	通过控制S的大于0或者小于0，实现开关功能


#### 信号量的应用




###### 生产者-消费者问题

以单缓冲区1对1生产者消费者问题为例
empty =1 full =0 
生产者：
生产消息
P(empty) //empty--; empty <= 0则阻塞,否则放行
写入缓冲区
V(full) //full++，唤醒消费者


消费者：
P(full)//full--; full <= 0 则阻塞，full = 1放行;
消费消息
V(empty)//empty++,唤醒生产者

多生产者多消费者且缓冲区空间为n 时，还需要在生产和消费之前上锁
注意不能调换资源信号量与互斥锁的位置，否则会发生严重问题


所以可以使用AND信号量进行打包

##### 无缓冲区容量限制的一对一生产者-消费者问题
full = 0;
生产者：
生产消息
写入缓冲区
L = L + 1;//更新记录
V(full) //full++，唤醒消费者
//V()操作之后生产者可以在消费者执行P()之前继续循环写入缓冲区


消费者：
P(full)//full--; full <= 0 则阻塞，full = 1放行;
消费消息
M = M + 1;//更新记录


##### 哲学家进餐问题

##### 读写锁
多个读进程可以同时读取，但是写进程与其他进程（包括其他写进程）存在互斥




##### 管程机制
定义了一个数据结构（类）
管程名称
局部于管程的共享数据区块
管程内各种方法
操作过程队列


### 进程通信


#### 类型

##### 低级进程通信
信号量、条件变量之类的低级通信方式，只支持少量信息交流，优点是速度快
##### 高级进程通信

- 共享存储器系统
			例如共享数据结构 生产者消费者有界缓冲区（少量数据）
			共享存储区 内存池
			适合传输大量数据

- 管道系统
		以字符流的形式传输大量信息
		基于pipe共享文件，适用于进程读写需求
		实现互斥、同步

- 消息传递系统
		基于操作系统，对应用透明
		以报文的形式发送格式化的消息
		直接通信：例如系统信号
		间接通信：通过共享实体（邮箱）进行消息的发送和接收



##### 信箱系统
公有信箱
私有信箱

支持一对一，一对多，多对多


##### 消息缓冲队列







### 线程
线程是进程的一部分，是处理器调度的基本单位
线程共享进程的内存空间